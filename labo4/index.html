<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Labo 4</title>
  </head>
  <body>

    <div id="cosx" style="float:left;">
      <h1>Cos(x) approximé avec Taylor</h1>
      <canvas width="600px" height="480px" id="cosxCanvas"></canvas>
      <br>
      <label>
        N min:
        <input style="width:35px;" type="number" name="n_min" value="1" id="cosx-n_min"/>
      </label>
      <label>
        N max:
        <input style="width:35px;" type="number" name="n_max" value="20" id="cosx-n_max"/>
      </label>
      <button id="cosx-start">Start animation</button>
    </div>
    <div id="cosx-derivative" style="float:left;">
      <h1>Cos(x)' approximé avec Taylor</h1>
      <canvas width="600px" height="480px" id="cosxDerivativeCanvas"></canvas>
      <br>
      <label>
        N min:
        <input style="width:35px;" type="number" name="n_min" value="1" id="cosx-derivative-n_min"/>
      </label>
      <label>
        N max:
        <input style="width:35px;" type="number" name="n_max" value="20" id="cosx-derivative-n_max"/>
      </label>
      <label>
        h:
        <input style="width:25px;" type="number" name="cosx-derivative-h" value="1" step="0.1" id="cosx-derivative-h"/>
      </label>
      <button id="cosx-derivative-start">Start animation</button>
    </div>
    <div id="cosx-double-derivative" style="float:left;">
      <h1>Cos(x)'' approximé avec Taylor</h1>
      <canvas width="600px" height="480px" id="cosxDoubleDerivativeCanvas"></canvas>
      <br>
      <label>
        N min:
        <input style="width:35px;" type="number" name="n_min" value="1" id="cosx-double-derivative-n_min"/>
      </label>
      <label>
        N max:
        <input style="width:35px;" type="number" name="n_max" value="20" id="cosx-double-derivative-n_max"/>
      </label>
      <label>
        h:
        <input style="width:25px;" type="number" name="cosx-double-derivative-h" value="1" step="0.1" id="cosx-double-derivative-h"/>
      </label>
      <button id="cosx-double-derivative-start">Start animation</button>
    </div>
    <script src="graph.js"></script>
    <script>
    function central_derivative(f,x,h){
      return (f(x + h) - f(x-h))/(2*h);
    }

    function richardson_derivative(f,n,x,h){
      return (8 * (f(x + h/2,n) - f(x-h/2)) -f(x+h,n) + f(x-h)) / 6 * h;
    }

    function get_taylor_n_term(x,n){
      return parseFloat(Math.pow(-1,n) * Math.pow(x,2*n))/parseFloat(fact(2*n));
    }
    function fact(num){
        var rval=1;
        for (var i = 2; i <= num; i++)
            rval = rval * i;
        return rval;
    }
    function getRandomColor() {
        var letters = '0123456789ABCDEF'.split('');
        var color = '#';
        for (var i = 0; i < 6; i++ ) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    var cosxGraph = new Graph({
      canvasId: 'cosxCanvas',
      minX: -10,
      minY: -10,
      maxX: 10,
      maxY: 10,
      unitsPerTick: 1
    });
    var cosxDerivativeGraph = new Graph({
      canvasId: 'cosxDerivativeCanvas',
      minX: -10,
      minY: -10,
      maxX: 10,
      maxY: 10,
      unitsPerTick: 1
    });
    var cosxDoubleDerivativeGraph = new Graph({
      canvasId: 'cosxDoubleDerivativeCanvas',
      minX: -10,
      minY: -10,
      maxX: 10,
      maxY: 10,
      unitsPerTick: 1
    });
    var f = function(x,n=10){
      var sum = 0;
      for(var i = 0; i < n; i++){
        sum += get_taylor_n_term(x,i);
      }
      return sum;
    }


    document.getElementById("cosx-start").onclick = function(event){
      cosxGraph.deleteGraph();
      var min = document.getElementById("cosx-n_min").value;
      var max = document.getElementById("cosx-n_max").value;
      this.disabled = "true";
      for(var i = min,anim=0; i <= max ; i ++,anim++){
        var input = this;
        setTimeout(function(i_local,input){
          cosxGraph.drawEquation(function(x) {
            return f(x,i_local);
          }, getRandomColor(), 3);
          if(i_local >= max) input.removeAttribute("disabled");
        },anim*500,i,input);
      }
    };
    document.getElementById("cosx-derivative-start").onclick = function(event){
      cosxDerivativeGraph.deleteGraph();
      var min = document.getElementById("cosx-derivative-n_min").value;
      var max = document.getElementById("cosx-derivative-n_max").value;
      var h = document.getElementById("cosx-derivative-h").value;
      this.disabled = "true";
      for(var i = min,anim=0; i <= max ; i ++,anim++){
        var input = this;
        setTimeout(function(i_local,h_local,input){
          cosxDerivativeGraph.drawEquation(function(x) {
            return richardson_derivative(f,i_local,x,h_local);
          }, getRandomColor(), 3);
          if(i_local >= max) input.removeAttribute("disabled");
        },anim*500,i,parseFloat(h),input);
      }
    };
    document.getElementById("cosx-double-derivative-start").onclick = function(event){
      cosxDoubleDerivativeGraph.deleteGraph();
      var min = document.getElementById("cosx-double-derivative-n_min").value;
      var max = document.getElementById("cosx-double-derivative-n_max").value;
      var h = document.getElementById("cosx-double-derivative-h").value;
      this.disabled = "true";
      var inner_f = function(x,n){
        return richardson_derivative(f,n,x,1);
      }
      for(var i = min,anim=0; i <= max ; i ++,anim++){
        var input = this;
        setTimeout(function(i_local,h_local,input){
          cosxDoubleDerivativeGraph.drawEquation(function(x) {
            return richardson_derivative(inner_f,i_local,x,h_local);
          }, getRandomColor(), 3);
          if(i_local >= max) input.removeAttribute("disabled");
        },anim*500,i,parseFloat(h),input);
      }
    };
    </script>
  </body>
</html>
